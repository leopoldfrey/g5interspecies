<!DOCTYPE html>
<html lang="fr">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>G5 Controller</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Theme CSS -->
    <!--link href="css/grayscale.min.css" rel="stylesheet"-->
    <link href="css/grayscale.css" rel="stylesheet">
    
	<script src="js/ws.js"></script>
    <script src="js/ws2.js"></script>

    <script>

	var v = 0;

	function connectToWS() {
        // Connect to websocket server
        ws = new WebSocket(wsServer);

        // Log messages from the server
        ws.onmessage = function (e) {
            //console.log("| WS Received message: " + e.data);
            var reply = JSON.parse(e.data);
            
            // PROPAGATE LOCAL OSC
            if(reply.command == "sendOSC") {
            	console.log("| WS Received OSC message " + reply.address + ". Propagating to WS2");
            	sendOSC(reply.address, reply.args);
            }
        };

        // Log errors
        ws.onerror = function (error) {
            console.error("WebSocket Error " + error.stack);
        };

        ws.onopen = function (event) {
            console.log("- Connected to ws server");
            $.post("/iAmNewWheteTo",{}, function(data){
				if(data)
				{
					console.log("| Success sending iAmNewWheteTo");
					v = data;
					document.getElementById("curV").value = v;
				}
			});
        };
    }
    		
    function connectToWS2() {
        // Connect to websocket server
        ws2 = new WebSocket(wsServer2);

        // Log messages from the server
        ws2.onmessage = function (e) {
            console.log("| WS2 Received message: " + e.data);
            var reply = JSON.parse(e.data);
            if(reply.command == "users") {
            	//document.getElementById("curU").value = reply.users;
            }
        };

        // Log errors
        ws2.onerror = function (error) {
            console.error("* WS2 WebSocket Error " + error.stack);
        };

        ws2.onopen = function (event) {
            console.log("- Connected to ws2 server");
        };
    }
    
	function sendClearVotes() {
		if(confirm("Clear votes ?")) {
			$.post("/clearvotes",{type:"clearvotes"}, function(data){
				if(data==="ok") {
					console.log("- Success sending clearvotes");
				}
			});
		}
    }
    
    function sendClearGlobalVotes() {
		if(confirm("Clear global votes ?")) {
			$.post("/clearglobalvotes",{type:"clearglobalvotes"}, function(data){
				if(data==="ok") {
					console.log("- Success sending clearglobalvotes");
				}
			});
		}
    }
	
	function sendAddVotes() {
		if(confirm("Add local votes to global ?")) {
			$.post("/addlocalvotes",{type:"addvotes"}, function(data){
				if(data==="ok") {
					console.log("- Success sending addlocalvotes");
				}
			});
		}
    }
    
	function sendNextVote() {
		gotoVote(v+1 <= 28 ? v+1 : 28);
    }

	function sendPrevVote() {
		gotoVote(v-1 >= 0 ? v-1 : 0);
    }

	function gotoVote(_vote) {
		v = _vote;
		document.getElementById("curV").value = v;
		$.post("/gotoVote",{vote:_vote}, function(data){
			if(data==="ok") {
				console.log("- Success sending gotoVote");
			}
		});
    }
    
    function getUsers() {
    	$.post("/getUsers",{}, function(data){
			if(data) {
				console.log("- Success sending getUsers");
				document.getElementById("curU").value = data;
			}
		});
    }
    
    document.addEventListener("DOMContentLoaded", function(event) {
    	
    	// Connect to websocket server
    	connectToWS();
        connectToWS2();

    });

	function sendOSC2(_address, _args) {
		$.post("/sendOSC",{address:_address, args:_args}, function(data){
			if(data == "ok")
			{
				console.log("| Success sending /sendOSC to WS");
			}
		});
	}

	function sendOSC(_address, _args) {
		console.log("- Send OSC : "+_address);
		ws2.send(
			JSON.stringify(
			{
				type:"sendOSC",
				address:_address,
				args:_args
			})
			, function (err) {
				if (err) {
					console.log("* Error sending sendOSC to WS2");
				} else {
					console.log("| Success sending sendOSC to WS2");
				}  
			}
		);
	}
    
	</script>
	
</head>

	<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top" style="background-color: black">
		<!-- Navigation -->
    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation" style="display:none">
    </nav>

    <!-- Section -->
    <section id="section-standBy" class="container content-section text-center" style="padding:20px;">
		<input id="curV" type="text" class="btn btn-lg btn-click-look" style="width:220px; border:0px; text-align:center; color:gray; background-color:black;" disabled="disabled"/><br/>
		<button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="gotoVote(0)">Referendum</button><br/>
		<button class="btn btn-lg btn-click-look" style="width:100px; text-align:center; background-color:black; color: white;" onclick="sendPrevVote()"><<</button>
		<button class="btn btn-lg btn-click-look" style="width:100px; text-align:center; background-color:black; color: white;" onclick="sendNextVote()">>></button><br/>
		<button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="gotoVote(13)">Future</button><br/>
		<button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="gotoVote(28)">End</button><br/>
		<br/>
		<br/>
		<input type="text" class="btn btn-lg btn-click-look" style="width:220px; border:0px; text-align:center; color:white; background-color:black;" disabled="disabled" value="Charts"/><br/>
		<button class="btn btn-lg btn-click-look" style="width:100px; text-align:center; background-color:black; color: white;" onclick="sendOSC2('/chart/prev', JSON.stringify([{ type: 'i', value: 1 }]))"><<</button>
		<button class="btn btn-lg btn-click-look" style="width:100px; text-align:center; background-color:black; color: white;" onclick="sendOSC2('/chart/next', JSON.stringify([{ type: 'i', value: 1 }]))">>></button><br/>
		<br/>
		<br/>
		<button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="gotoVote(-1)">Reset Server</button><br/>
		<button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="sendClearVotes()">Clear Votes</button><br/>
		<!--button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="sendClearGlobalVotes()">Clear Global Votes</button><br/>
		<button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="sendAddVotes()">Add Local To Global</button><br/-->
		<button class="btn btn-lg btn-click-look" style="width:220px; text-align:center; background-color:black; color: white;" onclick="getUsers()">Get Users</button><br/>
		<input id="curU" type="text" class="btn btn-lg btn-click-look" style="width:220px; border:0px; text-align:center; background-color:black; color: gray;" disabled="disabled"/><br/>
	</section>
	
	<!-- jQuery -->
    <script src="vendor/jquery/jquery.js"></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

	</body>
</html>